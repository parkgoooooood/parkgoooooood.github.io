<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>小卡展示</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; margin: 20px; }
    h2 { margin-top: 40px; }
    .category { margin-bottom: 30px; }
    .image-container { display: flex; flex-wrap: wrap; gap: 10px; }
    .image-box { position: relative; width: 120px; }
    .image-box img { width: 100%; height: 120px; object-fit: cover; cursor: pointer; }
    .image-box p { text-align: center; font-size: 12px; margin: 5px 0 0 0; }
    .delete-btn {
      position: absolute; top: 5px; right: 5px;
      background: red; color: white; border: none; border-radius: 50%;
      width: 20px; height: 20px; font-size: 14px; display: none;
    }
    #adminSection { margin-top: 30px; display: none; }
    #passwordPrompt { display: none; }
    button { margin: 5px; padding: 5px 10px; }
  </style>
</head>
<body>

<h1>小卡展示平台</h1>

<button onclick="showPasswordPrompt()">管理员登录</button>
<div id="passwordPrompt">
  <input type="password" id="adminPassword" placeholder="请输入密码">
  <button onclick="login()">确定</button>
</div>

<div id="adminSection">
  <h2>管理员后台</h2>
  <label>选择分类:
    <select id="categorySelect"></select>
  </label>
  <input type="file" accept="image/*" id="fileInput" multiple>
  <input type="text" id="imageName" placeholder="图片名称">
  <button onclick="uploadImages()">上传</button>
  <button onclick="clearAll()">一键清空</button>
</div>

<div id="categoriesContainer"></div>

<!-- 大图弹窗 -->
<div id="previewModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000000aa; justify-content:center; align-items:center;">
  <img id="previewImg" style="max-width:90%; max-height:90%;">
</div>

<script>
const categories = [
  "9.9卡池", "15.9卡池", "星光卡", "25.9吒卡池", "29.9吒卡池",
  "金冬天卡池", "柳智敏卡池", "宁艺卓卡池", "吉赛尔卡池",
  "金智秀卡池", "lisa卡池", "Jennie卡池", "rose卡池", "宝怪卡池", "芙卡池"
];
let isAdmin = false;

// 初始化分类界面
function init() {
  const container = document.getElementById('categoriesContainer');
  container.innerHTML = '';
  const select = document.getElementById('categorySelect');
  select.innerHTML = '';
  categories.forEach(cat => {
    const div = document.createElement('div');
    div.className = 'category';
    div.innerHTML = `<h2>${cat}</h2><div class="image-container" id="cat-${cat}"></div>`;
    container.appendChild(div);

    const option = document.createElement('option');
    option.value = cat;
    option.textContent = cat;
    select.appendChild(option);

    loadImages(cat);
  });
}

function showPasswordPrompt() {
  document.getElementById('passwordPrompt').style.display = 'block';
}

function login() {
  const pwd = document.getElementById('adminPassword').value;
  if (pwd === '123456') {
    isAdmin = true;
    document.getElementById('adminSection').style.display = 'block';
    document.getElementById('passwordPrompt').style.display = 'none';
    init();
  } else {
    alert('密码错误');
  }
}

function uploadImages() {
  const files = document.getElementById('fileInput').files;
  const category = document.getElementById('categorySelect').value;
  const name = document.getElementById('imageName').value;
  if (!files.length) return;

  Array.from(files).forEach(file => {
    const reader = new FileReader();
    reader.onload = e => {
      const image = { src: e.target.result, name: name || file.name };
      const saved = JSON.parse(localStorage.getItem(category) || '[]');
      saved.push(image);
      localStorage.setItem(category, JSON.stringify(saved));
      loadImages(category);
    };
    reader.readAsDataURL(file);
  });
  document.getElementById('fileInput').value = '';
  document.getElementById('imageName').value = '';
}

function loadImages(category) {
  const container = document.getElementById(`cat-${category}`);
  container.innerHTML = '';
  const images = JSON.parse(localStorage.getItem(category) || '[]');

  images.forEach((img, index) => {
    const box = document.createElement('div');
    box.className = 'image-box';

    const imageEl = document.createElement('img');
    imageEl.src = img.src;
    imageEl.onclick = () => showPreview(img.src);

    const nameEl = document.createElement('p');
    nameEl.textContent = img.name || '未命名';

    const delBtn = document.createElement('button');
    delBtn.className = 'delete-btn';
    delBtn.textContent = '×';
    delBtn.onclick = () => {
      images.splice(index, 1);
      localStorage.setItem(category, JSON.stringify(images));
      loadImages(category);
    };
    if (isAdmin) delBtn.style.display = 'block';

    box.appendChild(imageEl);
    box.appendChild(nameEl);
    box.appendChild(delBtn);
    container.appendChild(box);
  });
}

function showPreview(src) {
  const modal = document.getElementById('previewModal');
  const img = document.getElementById('previewImg');
  img.src = src;
  modal.style.display = 'flex';
  modal.onclick = () => modal.style.display = 'none';
}

function clearAll() {
  if (confirm("确定要清空所有分类吗？")) {
    categories.forEach(cat => localStorage.removeItem(cat));
    init();
  }
}

init();
</script>
</body>
</html>